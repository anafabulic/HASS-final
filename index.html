<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <title>Singapore's Longest Bus Routes</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" href="css/styles.css">

</head>

<body>

<div class="grid">

    <div class="block gutter">
        <h1>Whatever Happened To The Long Bus Ride?</h1>
        <br>
    </div>

    <div class="block gutter">
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Sit amet tellus cras adipiscing. Euismod nisi porta lorem mollis aliquam. Nisl rhoncus mattis rhoncus urna neque. Dictumst quisque sagittis purus sit amet. Commodo quis imperdiet massa tincidunt nunc pulvinar sapien et. Ac turpis egestas integer eget aliquet nibh. Feugiat sed lectus vestibulum mattis. Elementum integer enim neque volutpat. Ipsum dolor sit amet consectetur adipiscing elit. Quisque sagittis purus sit amet. Id diam vel quam elementum pulvinar etiam. Non sodales neque sodales ut etiam sit. Pharetra vel turpis nunc eget.
        </p>
    </div>

    <div class="block gutter">
        <svg id="all_buses"></svg>
    </div>

    <div class="block gutter">
        <p>
            Enim eu turpis egestas pretium aenean pharetra. Et odio pellentesque diam volutpat commodo sed egestas egestas fringilla. Id venenatis a condimentum vitae sapien pellentesque habitant. Nibh sed pulvinar proin gravida hendrerit. Arcu non sodales neque sodales ut etiam sit. Aliquam eleifend mi in nulla. Vitae elementum curabitur vitae nunc sed velit dignissim sodales. Aliquam ultrices sagittis orci a scelerisque purus semper. Congue quisque egestas diam in. Metus dictum at tempor commodo. Sed sed risus pretium quam vulputate dignissim suspendisse. Ac ut consequat semper viverra. Vel pharetra vel turpis nunc eget lorem dolor sed viverra. Rhoncus est pellentesque elit ullamcorper dignissim cras. Dui nunc mattis enim ut tellus.
        </p>
    </div>

    <div class="block gutter">
        <svg id="longest_shortest"></svg>
    </div>

    <div class="block gutter">
        <p>
            Eget aliquet nibh praesent tristique magna sit amet purus gravida. Est ultricies integer quis auctor elit sed vulputate mi. Posuere lorem ipsum dolor sit amet consectetur adipiscing elit. Varius duis at consectetur lorem. Lacus vestibulum sed arcu non odio euismod lacinia at. Nisl vel pretium lectus quam id leo in. Viverra nibh cras pulvinar mattis. Auctor urna nunc id cursus metus aliquam eleifend. Amet tellus cras adipiscing enim. Malesuada proin libero nunc consequat interdum varius sit amet. Venenatis a condimentum vitae sapien pellentesque habitant morbi. Orci ac auctor augue mauris augue neque. Donec adipiscing tristique risus nec feugiat in fermentum posuere urna. Quam lacus suspendisse faucibus interdum posuere.
        </p>
    </div>

    <div class="block gutter">
        <svg id="route_lengths"></svg>
    </div>

    <div class="block gutter">
        <p>
            Eget aliquet nibh praesent tristique magna sit amet purus gravida. Est ultricies integer quis auctor elit sed vulputate mi. Posuere lorem ipsum dolor sit amet consectetur adipiscing elit. Varius duis at consectetur lorem. Lacus vestibulum sed arcu non odio euismod lacinia at. Nisl vel pretium lectus quam id leo in. Viverra nibh cras pulvinar mattis. Auctor urna nunc id cursus metus aliquam eleifend. Amet tellus cras adipiscing enim. Malesuada proin libero nunc consequat interdum varius sit amet. Venenatis a condimentum vitae sapien pellentesque habitant morbi. Orci ac auctor augue mauris augue neque. Donec adipiscing tristique risus nec feugiat in fermentum posuere urna. Quam lacus suspendisse faucibus interdum posuere.
        </p>
    </div>

    <div class="block gutter">
        <svg id="route_viewer"></svg>
    </div>

    <div class="block gutter" style="height:100px;">
        <div>
            <p>
                Source(s): etc. etc. etc.
            </p>
            <p>
                Credits: etc. etc. etc.
            </p>
        </div>
    </div>

</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>

// Define dimensions
let w = 1000, h = 600, gutter = 20;

// Define d3 selections
let svg_ab = d3.select("svg#all_buses")
    .attr("viewBox", `0 0 ${w} ${h}`);
let svg_ls = d3.select("svg#longest_shortest")
    .attr("viewBox", `0 0 ${w} ${h}`);
let svg_rl = d3.select("svg#route_lengths")
    .attr("viewBox", `0 0 ${w} ${h}`);
let svg_rv = d3.select("svg#route_viewer")
    .attr("viewBox", `0 0 ${w} ${h}`);

// Define URIs
let basemap_uri = "https://raw.githubusercontent.com/anafabulic/HASS-final/main/json/sg_plnarea_simple.geojson";
let data_uri = "https://raw.githubusercontent.com/anafabulic/HASS-final/main/json/service_summary.json";


Promise.all([d3.json(data_uri), d3.json(basemap_uri)]).then(data => {
    
    // Define variables/objects; rewind data[0] as basemap
    let routes = data[0];
    let basemap = data[1];
    let basemap_r = basemap.features;
    for (let i = 0; i < basemap_r.length; i++) {
        if (basemap_r[i].geometry.type == "MultiPolygon") {
            for (let j = 0; j < basemap_r[i].geometry.coordinates.length; j++) {
                basemap_r[i].geometry.coordinates[j][0].reverse();
            }
        } else {
            basemap_r[i].geometry.coordinates[0].reverse();
        }
    }; 
    basemap.features = basemap_r;

    console.log(basemap);
    console.log(routes);

    // 1. Drawing svg all_buses
        
    // Define d3 projection
    let projection = d3.geoMercator()
        .fitExtent(
            [
                [gutter, gutter],
                [w - gutter, h - gutter]
            ],
            basemap
        );
    let geopath = d3.geoPath().projection(projection);

    // Draw map

    svg_ab.append("g")
        .attr("id", "basemap")
        .selectAll("path")
        .data(basemap.features)
        .enter()
        .append("path")
        .attr("d", geopath);
    
    // Construct bus stop array
    let stops_l = [];
    let stops_c = {};
    routes.forEach(function(route) {
        route.stops.forEach(function(item) {
            stops_l.push(
                {
                    "stop": item.stop,
                    "latitude": item.latitude,
                    "longitude": item.longitude,
                }
            );
        });
    });
    console.log(stops_l);
    stops_l.forEach(function(item) {
        l = Object.keys(stops_c)
        if (!l.includes(item.stop)) {
            stops_c[item.stop] = 1;
        } else {
            stops_c[item.stop] += 1 ;
        };
    });
    console.log(stops_c);


});

</script>

</body>
</html>

